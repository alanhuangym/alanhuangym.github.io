<!doctype html>




<html class="theme-next pisces" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Note down something">
<meta property="og:url" content="http://www.pirrla.cn/index.html">
<meta property="og:site_name" content="Note down something">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Note down something">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":true},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.pirrla.cn/"/>





  <title> Note down something </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Note down something</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/12/18/jenkins/jenkins2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/18/jenkins/jenkins2/" itemprop="url">
                  Jenkins学习笔记2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-18T00:00:00+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jenkins/" itemprop="url" rel="index">
                    <span itemprop="name">jenkins</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-代码质量管理"><a href="#1-代码质量管理" class="headerlink" title="1.代码质量管理"></a>1.代码质量管理</h3><p><img src="http://ondsf10qe.bkt.clouddn.com/jenkins1.png" alt=""></p>
<p>此次代码质量管理的需求，是在用户将本地的代码提交到远程仓库前，进行代码质量分析。</p>
<p>如果代码质量，此处的代码质量不单单指有无拼写错误、格式错误等，还包括代码重复率、</p>
<p>参考资料：</p>
<p>1.<a href="https://docs.sonarqube.org/display/PLUG/GitHub+Plugin" target="_blank" rel="external">Github Plugin for Sonar</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/12/18/jenkins/jenkins3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/18/jenkins/jenkins3/" itemprop="url">
                  Jenkins学习笔记3-重启Node.js服务
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-18T00:00:00+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jenkins/" itemprop="url" rel="index">
                    <span itemprop="name">jenkins</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们在之前的文章已经完成了当github上python代码有新的push操作之后，jenkins会自动pull最新的代码，并进行编译执行。因为python代码不能体现服务的持续展现，所以我们现在选择一个网站的node.js页面进行尝试。</p>
<h3 id="1-项目代码简介"><a href="#1-项目代码简介" class="headerlink" title="1.项目代码简介"></a>1.项目代码简介</h3><h3 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h3><p>对于网页项目，还有许多的流程可以持续发布。</p>
<h5 id="1-可以部署多个浏览器环境进行测试："><a href="#1-可以部署多个浏览器环境进行测试：" class="headerlink" title="1.可以部署多个浏览器环境进行测试："></a>1.可以部署多个浏览器环境进行测试：</h5><p>在网站的上线之前，可以部署一些浏览器测试环境，例如Firefox,IE,Safari等等的不同环境，当全部环境通过测试之后，才发布，提高了产品的容错性。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/12/18/jenkins/jenkins1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/18/jenkins/jenkins1/" itemprop="url">
                  Jenkins学习笔记1-Jenkins入门
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-18T00:00:00+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jenkins/" itemprop="url" rel="index">
                    <span itemprop="name">jenkins</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-敏捷开发"><a href="#1-敏捷开发" class="headerlink" title="1.敏捷开发"></a>1.敏捷开发</h3><p>普通的程序开发，是按照瀑布流一样的流程往下走的。</p>
<p>但是时至今日，客户的需求变化速度非常之快，而且生产环境也在不断变化，所以以往的单一的以计划来完成软件开发已经不可取了。</p>
<p>所以我们需要采取敏捷开发，<em>*</em></p>
<h3 id="2-Jenkins入门"><a href="#2-Jenkins入门" class="headerlink" title="2.Jenkins入门"></a>2.Jenkins入门</h3><h5 id="2-1Jenkins安装"><a href="#2-1Jenkins安装" class="headerlink" title="2.1Jenkins安装"></a>2.1Jenkins安装</h5><p>在<a href="https://jenkins.io/" target="_blank" rel="external">官网</a>下载.war文件，然后直接在命令行运行<code>java -jar jenkins.war</code></p>
<p>当命令行出现jenkins is running即已经成功启动了服务</p>
<p>默认端口为localhost:8080</p>
<p>**</p>
<p>macos如果遇到不能进入的文件夹，get info 然后添加权限用户即可</p>
<p>例如配置jenkins需要进入</p>
<p>/Users/Shard/Jenkins/home/secrets</p>
<p>**</p>
<p>参考资料：</p>
<ol>
<li><a href="http://blog.csdn.net/abcdocker/article/category/6638595" target="_blank" rel="external">持续集成 by www.abcdocker.com</a></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/09/19/other/html_notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/19/other/html_notes/" itemprop="url">
                  HTML学习笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-19T00:00:00+08:00">
                2017-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/html/" itemprop="url" rel="index">
                    <span itemprop="name">html</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><p>使用小写</p>
<p><code>&lt;br /&gt;</code> 是空行</p>
<p>浏览器会自动地在段落、标题的前后添加空行。（<code>&lt;p&gt; &lt;h1&gt;-&lt;h6&gt;</code>是块级元素）</p>
<p>避免使用<code>&lt;font&gt;</code>等标签了，使用style</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt;Look! Styles and colors&lt;/h1&gt;</div><div class="line"></div><div class="line">&lt;p style=&quot;font-family:verdana;color:red&quot;&gt;</div><div class="line">This text is in Verdana and red&lt;/p&gt;</div><div class="line"></div><div class="line">&lt;p style=&quot;font-family:times;color:green&quot;&gt;</div><div class="line">This text is in Times and green&lt;/p&gt;</div><div class="line"></div><div class="line">&lt;p style=&quot;font-size:30px&quot;&gt;This text is 30 pixels high&lt;/p&gt;</div></pre></td></tr></table></figure>
<p>header 中用meta重定向</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=gb2312&quot; /&gt;</div><div class="line">&lt;meta http-equiv=&quot;Refresh&quot; content=&quot;5;url=http://www.w3school.com.cn&quot; /&gt;</div><div class="line">&lt;/head&gt;</div></pre></td></tr></table></figure>
<p>小于号&lt; <code>&amp;lt;</code>  大于号&gt;<code>&amp;gt;</code>空格最好用 <code>&amp;nbsp;</code></p>
<p>上传超过一个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;form action=&quot;/example/html5/demo_form.asp&quot; method=&quot;get&quot;&gt;</div><div class="line">选择图片：&lt;input type=&quot;file&quot; name=&quot;img&quot; multiple=&quot;multiple&quot; /&gt;</div><div class="line">&lt;input type=&quot;submit&quot; /&gt;</div><div class="line">&lt;/form&gt;</div><div class="line">&lt;p&gt;请尝试在浏览文件时选取一个以上的文件。&lt;/p&gt;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/09/13/fs/fs3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/13/fs/fs3/" itemprop="url">
                  文件系统3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-13T14:23:06+08:00">
                2017-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/filesystem/" itemprop="url" rel="index">
                    <span itemprop="name">filesystem</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Mongo-Connector-设置"><a href="#Mongo-Connector-设置" class="headerlink" title="Mongo Connector 设置"></a><a href="https://my.oschina.net/tianlele/blog/848860" target="_blank" rel="external">Mongo Connector 设置</a></h3><p>为ES添加pinyin搜索</p>
<p>google open search</p>
<p><a href="https://disq.us/url?url=https%3A%2F%2Faaronparecki.com%2F2011%2F07%2F11%2F3%2Fhow-to-let-google-power-opensearch-on-your-website%3AHsv8oJR1pwEePhD0jpqWGdgJoCU&amp;cuid=3833100" target="_blank" rel="external">https://aaronparecki.com/20…</a></p>
<h3 id="TIKA读取附件"><a href="#TIKA读取附件" class="headerlink" title="TIKA读取附件"></a>TIKA读取附件</h3><p>tika — help</p>
<p><strong>1.tika-python 调用</strong></p>
<p><a href="https://github.com/chrismattmann/tika-python" target="_blank" rel="external">tika-python</a>是python的一个第三方库，可以快捷地调用tika很实用</p>
<p>安装库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install tika</div></pre></td></tr></table></figure>
<p>第一次调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> tika</div><div class="line">tika.initVM()</div><div class="line"><span class="keyword">from</span> tika <span class="keyword">import</span> parser</div><div class="line"></div><div class="line">parsed = parser.from_file(<span class="string">r'/Users/alan/Downloads/1/1.pptx'</span>)</div><div class="line">print(parsed[<span class="string">"metadata"</span>])</div><div class="line">print(parsed[<span class="string">"content"</span>])</div></pre></td></tr></table></figure>
<p>会下载tika的整个java包，所以耗时较长，请耐心等待</p>
<p>下载完之后就可以直接使用，方便快捷</p>
<p>metadata包括以下数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">height</div><div class="line">tiff:ImageLength</div><div class="line">Data PlanarConfiguration</div><div class="line">resourceName</div><div class="line">tiff:BitsPerSample</div><div class="line">X-Parsed-By</div><div class="line">Compression Lossless</div><div class="line">width</div><div class="line">Compression NumProgressiveScans</div><div class="line">Transparency Alpha</div><div class="line">Chroma ColorSpaceType</div><div class="line">X-TIKA:parse_time_millis</div><div class="line">Compression CompressionTypeName</div><div class="line">Data BitsPerSample</div><div class="line">IHDR</div><div class="line">Data SampleFormat</div><div class="line">Chroma BlackIsZero</div><div class="line">Chroma NumChannels</div><div class="line">Dimension ImageOrientation</div><div class="line">embeddedRelationshipId</div><div class="line">X-TIKA:embedded_resource_path</div><div class="line">tiff:ImageWidth</div><div class="line">Content-Type</div><div class="line">Dimension PixelAspectRatio</div></pre></td></tr></table></figure>
<p>!使用tika-python会打开一个tika服务器（post文件进去返回解析的html），内存占用较大</p>
<p><strong>2.命令行调用</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -jar tika-app-1.16.jar --text doc</div></pre></td></tr></table></figure>
<p>doc是需要解析的文件路径</p>
<p>为了在node.js中内部调用，我们使用了child_process库</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</div><div class="line"></div><div class="line">exec((<span class="string">'java -jar tika-app-1.16.jar --text '</span>+<span class="string">'/Users/alan/Downloads/1/bb.pdf'</span>),<span class="function"><span class="keyword">function</span>(<span class="params">error,stdout,stderr</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span> (error !== <span class="literal">null</span>)&#123;</div><div class="line">		<span class="built_in">console</span>.error(<span class="string">'error'</span>);</div><div class="line">	&#125;;</div><div class="line">	<span class="built_in">console</span>.log(stdout);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>3.服务器模式调用</strong></p>
<p>命令行启动服务器模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -jar tika-app-1.16.jar --server --port 12345</div></pre></td></tr></table></figure>
<p>这是简单的服务器模式启动，仅供测试环境使用</p>
<p>更完善的服务器模式tika看<a href="https://wiki.apache.org/tika/TikaJAXRS" target="_blank" rel="external">https://wiki.apache.org/tika/TikaJAXRS</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/09/12/mongo-fuzhiji/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/12/mongo-fuzhiji/" itemprop="url">
                  MongoDB 复制集
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-12T14:24:00+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mongodb/" itemprop="url" rel="index">
                    <span itemprop="name">mongodb</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="MongoDB复制集开启（本机）"><a href="#MongoDB复制集开启（本机）" class="headerlink" title="MongoDB复制集开启（本机）"></a>MongoDB复制集开启（本机）</h3><p>在本地开启三个mongod，当作三个服务器，分别使用作<strong>主复制集、从复制集、仲裁复制集</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:28001   //主复制集</div><div class="line">127.0.0.1:28002   //从复制集</div><div class="line">127.0.0.1:28003   //仲裁复制集</div></pre></td></tr></table></figure>
<p><strong>1.首先建立三个文件夹分别存放数据库数据文件。</strong></p>
<p><strong>2.分别建立各自的conf配置文件</strong></p>
<p>配置内容如下：（三个服务器只是端口不同，其他配置相同）</p>
<p>/data/mongodb/conf/28001.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># 端口</div><div class="line">port=28001</div><div class="line"># 绑定ip地址</div><div class="line">bind_ip=127.0.0.1</div><div class="line"># 日志文件路径</div><div class="line">logpath=/data/mongodb/log/28001.log</div><div class="line"># 数据文件存放目录</div><div class="line">dbpath=/data/mongodb/data/28001/</div><div class="line"># 以追加的方式写日志</div><div class="line">logappend=true</div><div class="line"></div><div class="line">pidfilepath=/data/mongodb/data/28001/28001.pid</div><div class="line">fork=true</div><div class="line">oplogSize=1024</div><div class="line"># 复制集名称</div><div class="line">replSet=MyMongo</div></pre></td></tr></table></figure>
<p>其中复制集名称最重要，因为如果需要放在同一个复制集，必须保证不同的服务器的复制集名称完全相同。（<font color="red">其中replSet的S记得要大写</font>）</p>
<p><strong>3.启动三个服务器</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mongod -f /data/mongodb/conf/28001.conf</div><div class="line">mongod -f /data/mongodb/conf/28002.conf</div><div class="line">mongod -f /data/mongodb/conf/28003.conf</div></pre></td></tr></table></figure>
<p>后面跟的是配置文件的地址，启动完成后，会出现一个fork:successful的提示信息，而且不是在前台启动的，所以要注意，可能已经启动过了。</p>
<p>查找是否有启动可以使用以下命令查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -ef | grep mongo</div></pre></td></tr></table></figure>
<p><strong>4.初始化复制集</strong></p>
<p>如果是第一次进行初始化，进入需要成为主复制集的服务器，这里进入28001端口</p>
<p>进入mongo客户端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongo localhost:28001</div></pre></td></tr></table></figure>
<p>然后输入初始化命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rs.initiate(&#123;_id:&apos;MyMongo&apos;,members:[&#123;_id:1,host:&apos;127.0.0.1:28001&apos;&#125;]&#125;)</div></pre></td></tr></table></figure>
<p>第一个_id：复制集的名称</p>
<p>member：复制集服务器列表（因为其他服务器还没完成初始化，所以只有一个当前的服务器）</p>
<p>第二个_id：指定给服务器的ID</p>
<p>host：服务器主机地址</p>
<p><strong>5.添加从复制集合仲裁复制集</strong></p>
<p>完成初始化，可以看到，当前服务器的名称已经成为了primary。因为是整个复制集中第一个完成初始化的，所以该服务器成为主复制集。</p>
<p>然后我们需要添加从复制集：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rs.add(&apos;127.0.0.1:28002&apos;)</div></pre></td></tr></table></figure>
<p>{”ok“ : 1}添加成功</p>
<p>调用rs.status()可以查看到复制集的情况</p>
<p>然后我们添加仲裁复制集：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rs.addArb(&apos;127.0.0.1:28003&apos;)</div></pre></td></tr></table></figure>
<p>{”ok“ : 1}添加成功</p>
<p><strong>6.测试</strong></p>
<p>Ref:</p>
<p>[1] <a href="http://www.cnblogs.com/nicolegxt/p/6841442.html?utm_source=itdadao&amp;utm_medium=referral" target="_blank" rel="external">http://www.cnblogs.com/nicolegxt/p/6841442.html?utm_source=itdadao&amp;utm_medium=referral</a></p>
<p>[2] <a href="http://blog.csdn.net/lichangzai/article/details/50903130" target="_blank" rel="external">http://blog.csdn.net/lichangzai/article/details/50903130</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/09/12/fs/fs2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/12/fs/fs2/" itemprop="url">
                  文件系统2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-12T14:23:06+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/filesystem/" itemprop="url" rel="index">
                    <span itemprop="name">filesystem</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="FastDFS与GridFS的选择"><a href="#FastDFS与GridFS的选择" class="headerlink" title="FastDFS与GridFS的选择"></a>FastDFS与GridFS的选择</h3><h4 id="FastDFS"><a href="#FastDFS" class="headerlink" title="FastDFS"></a>FastDFS</h4><p>FastDFS服务器端有两个角色：追踪器（tracker）和存储节点（storage）。</p>
<p>追踪器：主要负责调度工作，在访问上起到<strong>负载均衡</strong>的作用。</p>
<p>存储节点：存储文件，完成文件管理的存储、同步和提供存取接口等功能。</p>
<p>FastDFS同时会对文件的metadata（相关属性，例如宽度等）进行管理，以键值对的方式表示。</p>
<p>建议文件大小： 4KB &lt; file_size &lt;500MB</p>
<p>系统结构：</p>
<p><img src="http://static.oschina.net/uploads/img/201204/20230218_pNXn.jpg" alt=""></p>
<p>存储节点采用分卷的组织方式。存储系统由一个或多个卷组成，卷与卷之间的文件是相对独立的。</p>
<p>一个卷可以由一台或多台存储服务器组成，多台存储服务器可以起到冗余备份和负载均衡的作用。</p>
<p><strong>上传文件交互过程：</strong></p>
<ol>
<li>client询问tracker上传到的storage，不需要附加参数；</li>
<li>tracker返回一台可用的storage；</li>
<li>client直接和storage通讯完成文件上传。 </li>
</ol>
<p><strong>下载文件交互过程：</strong></p>
<ol>
<li>client询问tracker下载文件的storage，参数为文件标识（卷名和文件名）；</li>
<li>tracker返回一台可用的storage；</li>
<li>client直接和storage通讯完成文件下载。</li>
</ol>
<h4 id="GridFS"><a href="#GridFS" class="headerlink" title="GridFS"></a>GridFS</h4><p>MongoDB单个document存储上限为16M，为了存储大于16M的文件，我们可以使用MongoDB官方的文件系统GridFS。</p>
<p>默认分割大小<strong>256K</strong>。</p>
<p>GridFS的思想很简单就是将一个很大的文件进行分割，分割后的每一个小文件作为一个document单独存储。然后提供了两个集合来存储分割的信息和文件的元信息。这两个集合默认是fs.files和fs.chunks。</p>
<p>fs.files集合就存储了这个文件的基本信息：</p>
<ul>
<li>_id</li>
<li>length: 文件的大小</li>
<li>filename: 文件的名称</li>
<li>chunkSize: 这个文件每一个分块的大小，单位是字节，默认为256K。</li>
<li>uploadDate: 文件上传的时间。</li>
<li>md5: MD5信息，以检查文件完整性</li>
</ul>
<p>fs.chunks集合包括以下几个字段：</p>
<ul>
<li>_id</li>
<li>n: 表示是分块中的第几块，从0开始。</li>
<li>data: 存储的是当前文件分块的二进制数据。</li>
<li>file_id: 表示的是该块是属于哪一个文件，存储的就是fs.files中document的_id。在读取文件的时候，先在fs.files集合中找满足条件的document，获取它的_id值，然后根据这个值到fs.chunks集合中查找所有files_id为该值的document，并按n排序，最后依次读取document中data的值拼凑出原来的文件。</li>
</ul>
<h3 id="Mongo-Connector使用心得"><a href="#Mongo-Connector使用心得" class="headerlink" title="Mongo Connector使用心得"></a>Mongo Connector使用心得</h3><p>当按照<a href="http://pirrla.cn/2017/09/05/fs/fs1/" target="_blank" rel="external">复制集开启流程</a>完成后，即可使用mongo connector。</p>
<ol>
<li>开启MongoDB复制集</li>
<li>开启ES</li>
<li>开启mongo connector</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo mongo-connector --auto-commit-interval=0 -m localhost:28001 -t localhost:9200 -d elastic2_doc_manager -n news.tj_reports -o /Users/alan/Downloads/oplog.txt</div></pre></td></tr></table></figure>
<font color="red">之前的表述有错误，开启mongo connector后数据会直接同步，旧数据也会</font>

<p><strong>MongoDB的database会作为es的index</strong></p>
<p><strong>collection会作为es的type</strong></p>
<p>然后各个字段都会同步到es中。（增删改都会，version会变）</p>
<h3 id="Mongo-connector-support-for-GridFS-2"><a href="#Mongo-connector-support-for-GridFS-2" class="headerlink" title="Mongo connector support for GridFS[2]"></a>Mongo connector support for GridFS[2]</h3><p>mongo connector支持将MongoDB的GridFS中的文件复制到es中，通过es的mapping种类attachment。(<del>已过期</del>)</p>
<ol>
<li>ES安装<a href="https://github.com/elastic/elasticsearch-mapper-attachments" target="_blank" rel="external">attachment插件</a></li>
</ol>
<ol>
<li>​</li>
</ol>
<p>attachment type 已经被<a href="https://www.elastic.co/guide/en/elasticsearch/plugins/5.6/mapper-attachments.html#mapper-attachments-install" target="_blank" rel="external">抛弃</a>？</p>
<font color="red">5.6ES推出了一个<a href="https://www.elastic.co/guide/en/elasticsearch/plugins/5.6/ingest-attachment.html" target="_blank" rel="external">Ingest Attachment Processor</a></font>





<p>Ref:</p>
<p>[1] <a href="http://www.oschina.net/p/fastdfs" target="_blank" rel="external">http://www.oschina.net/p/fastdfs</a></p>
<p>[2] <a href="https://github.com/mongodb-labs/mongo-connector/wiki/Usage%20with%20ElasticSearch" target="_blank" rel="external">https://github.com/mongodb-labs/mongo-connector/wiki/Usage%20with%20ElasticSearch</a></p>
<p>[3] <a href="http://blog.csdn.net/WK313753744/article/details/49943155" target="_blank" rel="external">FastDFS 介绍</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/09/05/rs/rs_5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/05/rs/rs_5/" itemprop="url">
                  推荐系统5
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-05T14:23:06+08:00">
                2017-09-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/recommendationsystem/" itemprop="url" rel="index">
                    <span itemprop="name">recommendationsystem</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="假设已经得出了目标用户的相似用户，现做出推荐"><a href="#假设已经得出了目标用户的相似用户，现做出推荐" class="headerlink" title="假设已经得出了目标用户的相似用户，现做出推荐"></a>假设已经得出了目标用户的相似用户，现做出推荐</h3><h3 id="1-推荐目标用户已购买的产品相似产品"><a href="#1-推荐目标用户已购买的产品相似产品" class="headerlink" title="1.推荐目标用户已购买的产品相似产品"></a>1.推荐目标用户已购买的产品相似产品</h3><p>由于用户在购买了产品后，当产品过了存续期后，可能需要继续购买同类型的产品，所以我们需要对用户之前购买的产品进行统计分析，继续推荐相似的产品给用户。</p>
<p><strong>1.大类</strong></p>
<p>当用户购买了多次相同大类的产品之后，我们可以认为该用户对该大类的风险程度、收益情况比较认可，所以有较大的可能性会再次购买，所以我们主要统计用户已购买产品大类的情况。</p>
<p><strong>2.天数</strong></p>
<p>由于用户对资金的灵活程度有自己的偏好，所以用户购买产品的天数比较固定或者有规律性，例如用户如果认为91天的产品的灵活程度和收益情况互相权衡之下最理想，那么用户对91天的产品的偏好是存在的。同时用户初期对产品的信任程度没有达到一定的高度，购买的天数可能会比较短，所以如果用户多次购买了同一类产品后，可以推荐同样的天数<strong>或更长的天数</strong>的产品。</p>
<p><strong>3.收益利率</strong></p>
<p>由于前两个属性产品大类和产品天数就决定了产品的收益情况，所以可以直接根据前两个属性直接得到用户的投资偏好。</p>
<p><strong>4.综上所述</strong></p>
<p>我们将统计用户购买过最多的产品类型和产品天数，然后将开放日期在未来或今日的产品选择出来，推荐给用户。</p>
<h3 id="2-推荐用户尝试其他类型产品"><a href="#2-推荐用户尝试其他类型产品" class="headerlink" title="2.推荐用户尝试其他类型产品"></a>2.推荐用户尝试其他类型产品</h3><p>统计相似用户前100位的购买习惯，然后推荐该用户未购买过的产品或者排名第一的产品。</p>
<p>因为统计前100位相似用户的时候已经筛选掉了只购买过一款产品的用户，所以不会出现无法推荐的问题。</p>
<p><strong>问题：如果购买习惯完全相同怎么处理？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1a6726cef907827da0411d9f107550b4fcfd2feb</div><div class="line">9.43% GF1806 0.250494227106 新睿利优先91天 债券型 91 6.55</div><div class="line">9.46% GF1807 0.228637469027 新睿利优先91天 债券型 91 6</div><div class="line">9.44% GF1805 0.377176516585 新睿利优先91天 债券型 91 4.35</div><div class="line">9.53% GF1802 0.256939429748 新睿利优先91天 债券型 91 5.5</div><div class="line">9.33% GF180F 0.758798112353 新睿利优先91天 债券型 91 3.8</div><div class="line">13.81% 879003 0.0578450717465 多添利14天 短期理财类 14 4.3</div><div class="line">10.56% GF1811 0.288599403176 新睿利优先91天 债券型 91 4.8</div><div class="line">9.71% GF180L 1.38227279375 新睿利优先91天 债券型 91 4.7</div><div class="line">9.40% 879005 0.0835590588465 多添利56天 短期理财类 56 5.2</div><div class="line">9.33% 879049 4.02077615455 多添利X36天 短期理财类 36 4.7</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">879002 54 多添利7天 短期理财类 7 4.4</div><div class="line">879004 42 多添利28天 短期理财类 28 4.6</div><div class="line">GF1808 23 新睿利优先91天 债券型 91 5.4</div><div class="line">GF1810 21 新睿利优先91天 债券型 91 </div><div class="line">879006 21 多添利91天 短期理财类 91 4.6</div><div class="line">GF1814 19 新睿利优先91天 债券型 91 6.2</div><div class="line">GF1804 14 新睿利优先91天 债券型 91 5.6</div><div class="line">GF1809 12 新睿利优先91天 债券型 91 3.6</div><div class="line">GF1803 11 新睿利优先91天 债券型 91 6</div><div class="line">GF1813 8 新睿利优先91天 债券型 91 6.2</div><div class="line">GF1812 8 新睿利优先91天 债券型 91 4.8</div><div class="line">GF1815 6 新睿利优先91天 债券型 91 5.3</div><div class="line">879007 5 多添利182天 短期理财类 182 4.75</div><div class="line">879287 3 多添利X28天 短期理财类 28 5.5</div><div class="line">879610 3 多添利X364天 短期理财类 364 4.8</div><div class="line">879114 3 多添利X182天 短期理财类 182 4.4</div><div class="line">879620 2 多添利X364天 短期理财类 364 4.9</div><div class="line">879119 2 多添利X364天 短期理财类 364 5.25</div><div class="line">GF1884 2 新睿利优先X189天 债券型 189 6.1</div><div class="line">GF1823 2 新睿利优先X126天 债券型 126 6</div><div class="line">879008 2 多添利364天 短期理财类 364 </div><div class="line">879208 2 多添利X126天 短期理财类 126 5.3</div><div class="line">879277 2 多添利X56天 短期理财类 56 4.6</div><div class="line">GF1887 1 新睿利优先X182天 债券型 182 4.9</div><div class="line">87953P 1 多添利X56天 短期理财类 56 4.45</div><div class="line">879579 1 多添利X364天 短期理财类 364 4.9</div><div class="line">879341 1 多添利X182天15 短期理财类 182 5.1</div><div class="line">879162 1 多添利X182天 短期理财类 182 4.1</div><div class="line">87913I 1 多添利X35天 短期理财类 35 4.5</div><div class="line">GF1821 1 新睿利优先X182天 债券型 182 5.25</div><div class="line">GF1894 1 新睿利优先X182天 债券型 182 5.3</div><div class="line">879218 1 多添利X28天 短期理财类 28 4.2</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/09/05/fs/fs1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/05/fs/fs1/" itemprop="url">
                  文件系统1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-05T14:23:06+08:00">
                2017-09-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/filesystem/" itemprop="url" rel="index">
                    <span itemprop="name">filesystem</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="数据库选择"><a href="#数据库选择" class="headerlink" title="数据库选择"></a>数据库选择</h3><p><strong>关系型数据库 - Oracle</strong></p>
<p>基础事务有四个特性：</p>
<ul>
<li>原子性：整个事务中的所有操作，要么全部完成，要么全部不完成，不可能停滞在中间某个环节。事务在执行过程中发生错误，会被回复 （Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。</li>
<li>一致性：在事务开始之前和事务结束以后，数据库的完整性限制没有被破坏。</li>
<li>隔离性：两个事务的执行是互不干扰的，一个事务不可能看到其他事务运行时，中间某一时刻的数据。</li>
<li>持久性：在事务完成以后，该事务对数据库所作的更改便持久地保存在数据库之中，并不会被回复。</li>
</ul>
<p>对网站来说，关系型数据库的很多特性不再需要了：</p>
<ul>
<li>事务一致性</li>
</ul>
<p>关系型数据库在对事物一致性的维护中有很大的开销，而现在很多web系统对事物的读写一致性都不高</p>
<ul>
<li>读写实时性</li>
</ul>
<p>对关系数据库来说，插入一条数据之后立刻查询，是肯定可以读出这条数据的，但是对于很多web应用来说，并不要求这么高的实时性，比如发一条消息之后，过几秒乃至十几秒之后才看到这条动态是完全可以接受的</p>
<ul>
<li>复杂SQL，特别是多表关联查询</li>
</ul>
<p>任何大数据量的web系统，都非常忌讳多个大表的关联查询，以及复杂的数据分析类型的复杂SQL报表查询，特别是SNS类型的网站，从需求以及产品阶级角度，就避免了这种情况的产生。往往更多的只是单表的主键查询，以及单表的简单条件分页查询，SQL的功能极大的弱化了</p>
<p><strong>NoSQL - MongoDB</strong></p>
<p>由于在本项目中，数据是新闻资讯的存储，而新闻资讯相互之间是相对独立的，所以不需要使用到关系型数据库。</p>
<p>非关系型数据库相当于是简化版的关系型数据库，减少了一些相对少用到的功能，提升了产品的性能。相对于关系型数据库，抛弃了ACID特性。</p>
<p>但是由于是基于键值对的特性，所以非常容易进行扩展，可拓展性强。</p>
<h3 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h3><p>但是MongoDB也有一个问题。由于MongoDB的文档结构为BJSON格式（BJSON全称：Binary JSON），而BJSON格式本身就支持保存二进制格式的数据，因此可以把文件的二进制格式的数据直接保存到MongoDB的文档结构中。但是由于一个BJSON的最大长度不能超过16M，所以限制了单个文档中能存入的最大文件不能超过<font color="red">16M</font></p>
<p>为了提供对大容量文件存取的支持，samus驱动提供了“GridFS”方式来支持。</p>
<p><strong>BJSON</strong></p>
<p><a href="http://blog.csdn.net/kwsy2008/article/details/48969607" target="_blank" rel="external">python 实现</a></p>
<p><strong>GridDFS</strong></p>
<p>MongoDB内置功能。</p>
<p>GridFS是一种在MongoDB中存储大二进制文件的机制。使用GridFS存文件有如下几个原因：</p>
<p>利用Grid可以简化需求。要是已经用了MongoDB，GridFS就可以不需要使用独立文件存储架构。</p>
<p>基本原理是将文件存储在两个Collection之中，一个保存文件索引，一个保存文件内容。4MB每一块。</p>
<table>
<thead>
<tr>
<th>指标</th>
<th>适合类型</th>
<th>文件分布</th>
<th>系统性能</th>
<th>复杂度</th>
<th>FUSE</th>
<th>POSIX</th>
<th>备份机制</th>
<th>通讯协议接口</th>
<th>社区支持</th>
<th></th>
<th>开发语言</th>
</tr>
</thead>
<tbody>
<tr>
<td>FastDFS</td>
<td>4KB~500MB</td>
<td>小文件合并存储不分片处理</td>
<td>很高</td>
<td>简单</td>
<td>不支持</td>
<td>不支持</td>
<td>组内冗余备份</td>
<td>ApiHTTP</td>
<td>国内用户群</td>
<td></td>
<td>C语言</td>
</tr>
<tr>
<td>TFS</td>
<td>所有文件</td>
<td>小文件合并，以block组织分片</td>
<td></td>
<td>复杂</td>
<td>不支持</td>
<td>不支持</td>
<td>Block存储多份,主辅灾备</td>
<td>APIhttp</td>
<td>少</td>
<td></td>
<td>C++</td>
</tr>
<tr>
<td>MFS</td>
<td>大于64K</td>
<td>分片存储</td>
<td>Master占内存多</td>
<td></td>
<td>支持</td>
<td>支持</td>
<td>多点备份动态冗余</td>
<td>使用fuse挂在</td>
<td>较多</td>
<td></td>
<td>Perl</td>
</tr>
<tr>
<td>HDFS</td>
<td>大文件</td>
<td>大文件分片分块存储</td>
<td></td>
<td>简单</td>
<td>支持</td>
<td>支持</td>
<td>多副本</td>
<td>原生api</td>
<td>较多</td>
<td></td>
<td>java</td>
</tr>
<tr>
<td>Ceph</td>
<td>对象文件块</td>
<td>OSD一主多从</td>
<td></td>
<td>复杂</td>
<td>支持</td>
<td>支持</td>
<td>多副本</td>
<td>原生api</td>
<td>较少</td>
<td></td>
<td>C++</td>
</tr>
<tr>
<td>MogileFS</td>
<td>海量小图片</td>
<td></td>
<td>高</td>
<td>复杂</td>
<td>可以支持</td>
<td>不支持</td>
<td>动态冗余</td>
<td>原生api</td>
<td>文档少</td>
<td></td>
<td>Perl</td>
</tr>
<tr>
<td>ClusterFS</td>
<td>大文件</td>
<td></td>
<td></td>
<td>简单</td>
<td>支持</td>
<td>支持</td>
<td>镜像</td>
<td></td>
<td>多</td>
<td></td>
<td>C</td>
</tr>
</tbody>
</table>
<p><strong>HDFS</strong></p>
<p>还是适合大数据处理，附件等文档太小，不适合使用HDFS。</p>
<p><strong>FastDFS</strong></p>
<ol>
<li>为互联网量身定制，海量数据文件存储。</li>
<li>高可用(同组备份机制)。</li>
<li>FastDFS不是通用的文件系统，只能通过api来访问，目前提供c,java,php客户端。phtyon由第三方开发者提供。</li>
<li>FastDFS可以看作是基于key/value pair存储系统，也许称为分布式文件存储服务更合适。</li>
<li>支持高并发(这个好像没体现出支持什么高并发,这个是nginx的功劳吧)</li>
</ol>
<h3 id="从MongoDB到ElasticSearch"><a href="#从MongoDB到ElasticSearch" class="headerlink" title="从MongoDB到ElasticSearch"></a>从MongoDB到ElasticSearch</h3><p>MongoDB 本身是自带文本索引功能的，但是，不支持中文。<strong>术业有专攻</strong>，MongoDB 是数据存储应用，那么全文检索就使用专业的全文搜索引擎吧。</p>
<p><strong>0.River</strong></p>
<p>由于只支持ES 2.0 以下版本，已弃用。</p>
<p><strong>1.<a href="https://github.com/mongodb-labs/mongo-connector" target="_blank" rel="external">Mongo-Connector</a></strong></p>
<p>实时</p>
<ul>
<li>MongoDB必须开启复制集[2]</li>
</ul>
<p>This assumes there is a MongoDB replica set running on port 27017 and that Elasticsearch is running on port 9200 both on the local machine.</p>
<ul>
<li>安装mongo-connector</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install &apos;mongo-connector[elastic5]&apos;</div></pre></td></tr></table></figure>
<ul>
<li>运行mongo-connector</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongo-connector -m 127.0.0.1:27017 -t 127.0.0.1:9200 -d elastic_doc_manager</div></pre></td></tr></table></figure>
<p>启动之后，现在开始，在mongoDB上的操作，都会同步到elasticsearch之中了。</p>
<p>（对旧数据无影响）</p>
<p>问题：根据其他用户的评价，mongo-conncetor会出现延迟和退出的现象</p>
<p><strong>2.<a href="https://github.com/keenwon/mongodb-to-elasticsearch" target="_blank" rel="external">mongodb to elasticsearch</a></strong></p>
<p>非实时，应对一天更新一次的场景</p>
<p>使用了mongoose</p>
<p>一个node.js写的小程序，可以将mongodb的数据输入到es。</p>
<p>Ref:</p>
<p>[1] <a href="https://segmentfault.com/a/1190000003773614" target="_blank" rel="external">MongoDB 数据自动同步到 ElasticSearch</a></p>
<p>[2] <a href="http://www.runoob.com/mongodb/mongodb-replication.html" target="_blank" rel="external">副本集设置</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/08/31/rs/rs_4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/31/rs/rs_4/" itemprop="url">
                  推荐系统4
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-31T14:17:36+08:00">
                2017-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/recommendationsystem/" itemprop="url" rel="index">
                    <span itemprop="name">recommendationsystem</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>

<h3 id="数据归一化"><a href="#数据归一化" class="headerlink" title="数据归一化"></a>数据归一化</h3><p>现在每个用户的属性变为了持有产品的份额：</p>
<p>直接使用份额计算会出现偏差化：</p>
<p>例如购买了一款产品金额较大，那么权重就会偏大</p>
<p>那么就将份额标准化</p>
<p><strong>1.固定阈值</strong></p>
<p>例如（万分之X）</p>
<table>
<thead>
<tr>
<th>方案</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr>
<td>方案1</td>
<td>0-0.03</td>
<td>0.03-0.1</td>
<td>0.1-0.3</td>
<td>0.3-1.0</td>
<td>1.0+</td>
</tr>
<tr>
<td>方案2</td>
<td>0-0.01</td>
<td>0.01-0.1</td>
<td>0.1-1.0</td>
<td>1.0-2.0</td>
<td>2.0+</td>
</tr>
</tbody>
</table>
<p>划分为五个评分，0分则是没有持仓过该产品</p>
<p><strong>2.平均持仓数</strong></p>
<p>计算出每个产品的用户平均持仓数，然后根据平均持仓倍数去划分数据：</p>
<table>
<thead>
<tr>
<th>方案</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr>
<td>方案1</td>
<td>0-0.5倍</td>
<td>0.5-1.0倍</td>
<td>1.0-1.5倍</td>
<td>1.5-2.0倍</td>
<td>2.0+倍</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>3.排序划分</strong></p>
<p>将一款产品的所有用户进行排序，然后根据排序去划分数据</p>
<table>
<thead>
<tr>
<th>方案</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr>
<td>方案1</td>
<td>20%</td>
<td>20%</td>
<td>20%</td>
<td>20%</td>
<td>20%</td>
</tr>
<tr>
<td>方案</td>
<td>10%</td>
<td>25%</td>
<td>30%</td>
<td>25%</td>
<td>10%</td>
</tr>
</tbody>
</table>
<p><strong>4.（0，1）标准化（max-min）</strong></p>
<p>$${x}_{normalization}=\frac{x-Min}{Max-Min}$$</p>
<p>然后将得到的结果乘以5，得到投资偏好。</p>
<p><strong>5.Z-score标准化</strong></p>
<p>将数据划分为正态分布化的数据</p>
<p>$${x}_{normalization}=\frac{x-\mu }{\sigma }$$</p>
<p>其中的u是平均数，sigma是标准差</p>
<h3 id="实验结果："><a href="#实验结果：" class="headerlink" title="实验结果："></a>实验结果：</h3><p><strong>0.不进行归一化</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">目标客户</div><div class="line">产品1 0.250494227106 新睿利优先91天 债券型 91</div><div class="line">产品2 0.228637469027 新睿利优先91天 债券型 91</div><div class="line">产品3 0.377176516585 新睿利优先91天 债券型 91</div><div class="line">产品4 0.256939429748 新睿利优先91天 债券型 91</div><div class="line">产品5 0.758798112353 新睿利优先91天 债券型 91</div><div class="line">产品6 0.0578450717465 多添利14天 短期理财类 14</div><div class="line">产品7 0.288599403176 新睿利优先91天 债券型 91</div><div class="line">产品8 1.38227279375 新睿利优先91天 债券型 91</div><div class="line">产品9 0.0835590588465 多添利56天 短期理财类 56</div><div class="line">产品10 4.02077615455 多添利X36天 短期理财类 36</div><div class="line">***********************************</div><div class="line">d96e788472f4d36ae9163192f84635d2b3332ced</div><div class="line">产品1 0.249496242138 新睿利优先91天 债券型 91</div><div class="line">产品5 0.758798112353 新睿利优先91天 债券型 91</div><div class="line">879002 0.0262265839131 多添利7天 短期理财类 7</div><div class="line">产品6 0.0390845079368 多添利14天 短期理财类 14</div><div class="line">产品9 0.0828958917128 多添利56天 短期理财类 56</div><div class="line">产品10 4.02077615455 多添利X36天 短期理财类 36</div><div class="line">***********************************</div><div class="line">b598fb7de5df3b8a73c5c23c98fb3c73483b020b</div><div class="line">产品1 0.249496242138 新睿利优先91天 债券型 91</div><div class="line">产品2 0.226822885939 新睿利优先91天 债券型 91</div><div class="line">产品3 0.374926954856 新睿利优先91天 债券型 91</div><div class="line">产品7 0.259999462321 新睿利优先91天 债券型 91</div><div class="line">GF1809 0.306768321508 新睿利优先91天 债券型 91</div><div class="line">879002 0.0233817984367 多添利7天 短期理财类 7</div><div class="line">879006 0.115620874347 多添利91天 短期理财类 91</div><div class="line">产品10 4.02077615455 多添利X36天 短期理财类 36</div><div class="line">***********************************</div><div class="line">36e64d058bd7a6c387ffe388179d4639749cc44f</div><div class="line">产品1 0.249496242138 新睿利优先91天 债券型 91</div><div class="line">GF1814 0.249990015339 新睿利优先91天 债券型 91</div><div class="line">GF1804 0.351223807748 新睿利优先91天 债券型 91</div><div class="line">产品3 0.375676808766 新睿利优先91天 债券型 91</div><div class="line">产品7 0.323959330052 新睿利优先91天 债券型 91</div><div class="line">GF1803 0.407730728967 新睿利优先91天 债券型 91</div><div class="line">产品2 0.229544760571 新睿利优先91天 债券型 91</div><div class="line">GF1812 0.355765682516 新睿利优先91天 债券型 91</div><div class="line">879119 0.729319808632 多添利X364天 短期理财类 364</div><div class="line">GF1809 0.311063078009 新睿利优先91天 债券型 91</div><div class="line">产品5 0.770938882151 新睿利优先91天 债券型 91</div><div class="line">879162 1.2696774613 多添利X182天 短期理财类 182</div><div class="line">879002 0.020420103968 多添利7天 短期理财类 7</div><div class="line">产品6 0.0394753530162 多添利14天 短期理财类 14</div><div class="line">产品8 1.38227279375 新睿利优先91天 债券型 91</div><div class="line">产品9 0.0830616834962 多添利56天 短期理财类 56</div><div class="line">879004 0.0871009660079 多添利28天 短期理财类 28</div><div class="line">产品10 4.02077615455 多添利X36天 短期理财类 36</div></pre></td></tr></table></figure>
<p>1.固定值归一化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">目标客户</div><div class="line">产品1 0.250494227106 3 新睿利优先91天 债券型 91</div><div class="line">产品2 0.228637469027 3 新睿利优先91天 债券型 91</div><div class="line">产品3 0.377176516585 4 新睿利优先91天 债券型 91</div><div class="line">产品4 0.256939429748 3 新睿利优先91天 债券型 91</div><div class="line">产品5 0.758798112353 4 新睿利优先91天 债券型 91</div><div class="line">产品6 0.0578450717465 2 多添利14天 短期理财类 14</div><div class="line">产品7 0.288599403176 3 新睿利优先91天 债券型 91</div><div class="line">产品8 1.38227279375 5 新睿利优先91天 债券型 91</div><div class="line">产品9 0.0835590588465 2 多添利56天 短期理财类 56</div><div class="line">产品10 4.02077615455 5 多添利X36天 短期理财类 36</div><div class="line">***********************************</div><div class="line">bb7a0f6f5d59a3bfcca72a685810c38c2bc8e3a3</div><div class="line">产品1 0.262470046729 3 新睿利优先91天 债券型 91</div><div class="line">产品3 0.451412053647 4 新睿利优先91天 债券型 91</div><div class="line">产品4 0.299002492211 3 新睿利优先91天 债券型 91</div><div class="line">产品6 0.101619720636 3 多添利14天 短期理财类 14</div><div class="line">产品8 1.38227279375 5 新睿利优先91天 债券型 91</div><div class="line">产品9 0.146891520115 3 多添利56天 短期理财类 56</div><div class="line">***********************************</div><div class="line">d96e788472f4d36ae9163192f84635d2b3332ced</div><div class="line">产品1 0.249496242138 3 新睿利优先91天 债券型 91</div><div class="line">产品5 0.758798112353 4 新睿利优先91天 债券型 91</div><div class="line">879002 0.0262265839131 1 多添利7天 短期理财类 7</div><div class="line">产品6 0.0390845079368 2 多添利14天 短期理财类 14</div><div class="line">产品9 0.0828958917128 2 多添利56天 短期理财类 56</div><div class="line">产品10 4.02077615455 5 多添利X36天 短期理财类 36</div><div class="line">***********************************</div><div class="line">f0f5de95640aabbb217a35a7b141b2bae46783aa</div><div class="line">产品5 4.58465819484 5 新睿利优先91天 债券型 91</div><div class="line">产品8 3.31469015941 5 新睿利优先91天 债券型 91</div><div class="line">产品3 0.374926954856 4 新睿利优先91天 债券型 91</div></pre></td></tr></table></figure>
<p>2.平均持仓数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">目标客户</div><div class="line">产品1 1 新睿利优先91天 债券型 91</div><div class="line">产品2 1 新睿利优先91天 债券型 91</div><div class="line">产品3 1 新睿利优先91天 债券型 91</div><div class="line">产品4 1 新睿利优先91天 债券型 91</div><div class="line">产品5 1 新睿利优先91天 债券型 91</div><div class="line">产品6 1 多添利14天 短期理财类 14</div><div class="line">产品7 1 新睿利优先91天 债券型 91</div><div class="line">产品8 1 新睿利优先91天 债券型 91</div><div class="line">产品9 1 多添利56天 短期理财类 56</div><div class="line">产品10 1 多添利X36天 短期理财类 36</div><div class="line">***********************************</div><div class="line">bb7a0f6f5d59a3bfcca72a685810c38c2bc8e3a3</div><div class="line">产品1 1 新睿利优先91天 债券型 91</div><div class="line">产品3 1 新睿利优先91天 债券型 91</div><div class="line">产品4 1 新睿利优先91天 债券型 91</div><div class="line">产品6 1 多添利14天 短期理财类 14</div><div class="line">产品8 1 新睿利优先91天 债券型 91</div><div class="line">产品9 1 多添利56天 短期理财类 56</div><div class="line">***********************************</div><div class="line">7b0fa22fec8c28836d6a52cd35aa818218cd4021</div><div class="line">产品1 1 新睿利优先91天 债券型 91</div><div class="line">产品2 1 新睿利优先91天 债券型 91</div><div class="line">产品7 1 新睿利优先91天 债券型 91</div><div class="line">产品4 1 新睿利优先91天 债券型 91</div><div class="line">产品6 1 多添利14天 短期理财类 14</div><div class="line">***********************************</div><div class="line">21cfa76118cad37e9af116b01ca19230b5def327</div><div class="line">产品1 1 新睿利优先91天 债券型 91</div><div class="line">产品2 1 新睿利优先91天 债券型 91</div><div class="line">产品7 1 新睿利优先91天 债券型 91</div><div class="line">产品4 1 新睿利优先91天 债券型 91</div></pre></td></tr></table></figure>
<p>3.(0,1)归一化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">目标客户</div><div class="line">产品1 0.00250205597229 新睿利优先91天 债券型 91</div><div class="line">产品2 0.00611680178649 新睿利优先91天 债券型 91</div><div class="line">产品3 0.00628624275145 新睿利优先91天 债券型 91</div><div class="line">产品4 0.00281313461987 新睿利优先91天 债券型 91</div><div class="line">产品5 0.0110457409948 新睿利优先91天 债券型 91</div><div class="line">产品6 9.96838674323e-05 多添利14天 短期理财类 14</div><div class="line">产品7 0.00168125266956 新睿利优先91天 债券型 91</div><div class="line">产品8 0.0126821535272 新睿利优先91天 债券型 91</div><div class="line">产品9 0.000251958300901 多添利56天 短期理财类 56</div><div class="line">产品10 0.00139546358688 多添利X36天 短期理财类 36</div><div class="line">***********************************</div><div class="line">53685bbde6333d222b00c006f27ef581c88a4b1d</div><div class="line">产品1 0.00330949236175 新睿利优先91天 债券型 91</div><div class="line">产品2 0.00606825574057 新睿利优先91天 债券型 91</div><div class="line">产品4 0.00277429449691 新睿利优先91天 债券型 91</div><div class="line">GF1808 0.0049099997054 新睿利优先91天 债券型 91</div><div class="line">产品5 0.0110457409948 新睿利优先91天 债券型 91</div><div class="line">产品8 0.0126821535272 新睿利优先91天 债券型 91</div><div class="line">879004 0.000391751898821 多添利28天 短期理财类 28</div><div class="line">***********************************</div><div class="line">2ff657077263d4833bad7d8c8035c623e336c977</div><div class="line">GF1814 0.00701227648786 新睿利优先91天 债券型 91</div><div class="line">产品2 0.00646876061945 新睿利优先91天 债券型 91</div><div class="line">产品3 0.00624875024995 新睿利优先91天 债券型 91</div><div class="line">产品4 0.00280203744188 新睿利优先91天 债券型 91</div><div class="line">879637 0.0 多添利X97天 短期理财类 97</div><div class="line">GF1812 0.00261713803293 新睿利优先91天 债券型 91</div><div class="line">87905M 0.0 多添利X181天 短期理财类 181</div><div class="line">87913V 0.0 多添利X90天 短期理财类 90</div><div class="line">GF1808 0.00505729969656 新睿利优先91天 债券型 91</div><div class="line">产品5 0.0110457409948 新睿利优先91天 债券型 91</div><div class="line">产品1 0.0025718344257 新睿利优先91天 债券型 91</div><div class="line">产品7 0.00151464204465 新睿利优先91天 债券型 91</div><div class="line">产品8 0.0126821535272 新睿利优先91天 债券型 91</div><div class="line">879580 0.0 多添利X91天 短期理财类 91</div><div class="line">87907S 0.0 多添利X181天 短期理财类 181</div><div class="line">879410 0.0 多添利X90天 短期理财类 90</div><div class="line">***********************************</div><div class="line">ece0720feb0ff36294d63aef73021496db43f7b3</div><div class="line">产品5 0.0111852661442 新睿利优先91天 债券型 91</div><div class="line">879002 4.82520920901e-05 多添利7天 短期理财类 7</div><div class="line">产品8 0.0126821535272 新睿利优先91天 债券型 91</div></pre></td></tr></table></figure>
<p>4.Z-score</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">目标客户</div><div class="line">产品1 -0.319787520279</div><div class="line">产品2 -0.40743813927</div><div class="line">产品3 -0.349684885459</div><div class="line">产品4 -0.359717190383</div><div class="line">产品5 -0.405274114882</div><div class="line">产品6 -0.0725244748709</div><div class="line">产品7 -0.262125545055</div><div class="line">产品8 -0.441496892426</div><div class="line">产品9 -0.133596718487</div><div class="line">产品10 -0.266415990907</div><div class="line">***********************************</div><div class="line">da7ab1c15153fcf193a6fc7d754ae0d3c4d598af</div><div class="line">产品1 -0.218140849102</div><div class="line">产品2 -0.179129356215</div><div class="line">产品4 -0.331388969459</div><div class="line">GF1810 -0.268200096133</div><div class="line">产品5 -0.405274114882</div><div class="line">产品8 -0.441496892426</div><div class="line">***********************************</div><div class="line">bd086050bbaec0d4f07094224c4bf46cf64d057c</div><div class="line">产品1 -0.320230425164</div><div class="line">产品2 -0.40743813927</div><div class="line">87911V -0.247691581664</div><div class="line">产品3 -0.350590828042</div><div class="line">产品4 -0.356399470815</div><div class="line">GF1814 -0.0395975964336</div><div class="line">产品5 -0.404049998232</div><div class="line">GF1874 -0.30671101606</div><div class="line">产品6 -0.0764411040059</div><div class="line">产品7 -0.267856858948</div><div class="line">***********************************</div><div class="line">2681a76a23e95e26c0a84029644bb510547ee7cd</div><div class="line">产品1 -0.320230425164</div><div class="line">产品2 -0.511840648104</div><div class="line">产品7 -0.316486188947</div><div class="line">产品5 -0.488208017918</div><div class="line">879002 -0.0736386038632</div><div class="line">产品4 -0.432451811674</div></pre></td></tr></table></figure>
<h3 id="时间权重："><a href="#时间权重：" class="headerlink" title="时间权重："></a>时间权重：</h3><p>建立一个字典</p>
<p>{</p>
<p>“user1”:</p>
<p>{“87006”：“2017-01-03”</p>
<p>}</p>
<p>}</p>
<p>然后 在计算金额权重的时候，再乘以这个权重。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ondsf10qe.bkt.clouddn.com/avatar01.png"
               alt="Alan Wong" />
          <p class="site-author-name" itemprop="name">Alan Wong</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/alanhuangym" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alan Wong</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
