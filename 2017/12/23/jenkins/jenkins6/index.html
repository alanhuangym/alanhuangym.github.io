<!doctype html>




<html class="theme-next pisces" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jenkins,git," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="1. 搭建gitlab仓库1.1 安装前准备工作由于需要实现代码仓库的质量管理操作，所以我们需要搭建一个gitlab的仓库。

GitLab是一个利用 Ruby on Rails 开发的开源应用程序，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。 
　　GitLab拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提">
<meta property="og:type" content="article">
<meta property="og:title" content="Jenkins学习笔记6-搭建gitlabs仓库&Gtilab实现代码质量管理（提交到代码仓库前）">
<meta property="og:url" content="http://www.pirrla.cn/2017/12/23/jenkins/jenkins6/index.html">
<meta property="og:site_name" content="Note down something">
<meta property="og:description" content="1. 搭建gitlab仓库1.1 安装前准备工作由于需要实现代码仓库的质量管理操作，所以我们需要搭建一个gitlab的仓库。

GitLab是一个利用 Ruby on Rails 开发的开源应用程序，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。 
　　GitLab拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提">
<meta property="og:image" content="http://ondsf10qe.bkt.clouddn.com/jenkins26.png">
<meta property="og:image" content="http://ondsf10qe.bkt.clouddn.com/jenkins27.png">
<meta property="og:image" content="http://ondsf10qe.bkt.clouddn.com/jenkins28.png">
<meta property="og:image" content="http://ondsf10qe.bkt.clouddn.com/jenkins29.png">
<meta property="og:image" content="http://ondsf10qe.bkt.clouddn.com/jenkins32.png">
<meta property="og:image" content="http://ondsf10qe.bkt.clouddn.com/jenkins35.png">
<meta property="og:image" content="http://ondsf10qe.bkt.clouddn.com/jenkins33.png">
<meta property="og:image" content="http://ondsf10qe.bkt.clouddn.com/jenkins34.png">
<meta property="og:updated_time" content="2017-12-28T07:42:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jenkins学习笔记6-搭建gitlabs仓库&Gtilab实现代码质量管理（提交到代码仓库前）">
<meta name="twitter:description" content="1. 搭建gitlab仓库1.1 安装前准备工作由于需要实现代码仓库的质量管理操作，所以我们需要搭建一个gitlab的仓库。

GitLab是一个利用 Ruby on Rails 开发的开源应用程序，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。 
　　GitLab拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提">
<meta name="twitter:image" content="http://ondsf10qe.bkt.clouddn.com/jenkins26.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":true},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.pirrla.cn/2017/12/23/jenkins/jenkins6/"/>





  <title> Jenkins学习笔记6-搭建gitlabs仓库&Gtilab实现代码质量管理（提交到代码仓库前） | Note down something </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Note down something</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.pirrla.cn/2017/12/23/jenkins/jenkins6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alan Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ondsf10qe.bkt.clouddn.com/avatar01.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Note down something">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Jenkins学习笔记6-搭建gitlabs仓库&Gtilab实现代码质量管理（提交到代码仓库前）
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-23T00:00:00+08:00">
                2017-12-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jenkins/" itemprop="url" rel="index">
                    <span itemprop="name">jenkins</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="1-搭建gitlab仓库"><a href="#1-搭建gitlab仓库" class="headerlink" title="1. 搭建gitlab仓库"></a>1. 搭建gitlab仓库</h3><h5 id="1-1-安装前准备工作"><a href="#1-1-安装前准备工作" class="headerlink" title="1.1 安装前准备工作"></a>1.1 安装前准备工作</h5><p>由于需要实现代码仓库的质量管理操作，所以我们需要搭建一个gitlab的仓库。</p>
<blockquote>
<p>GitLab是一个利用 <code>Ruby on Rails</code> 开发的开源应用程序，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。 </p>
<p>　　GitLab拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。</p>
</blockquote>
<p>在<a href="http://pirrla.cn/2017/12/21/jenkins/jenkins4/" target="_blank" rel="external">之前的教程</a>里，我们已经装好了docker，现在有了docker，所以搭建运行环境都比较方便，我们这里直接使用docker进行gitlab的搭建。</p>
<p>使用以下命令拉取所需要的docker镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker pull sameersbn/redis</div><div class="line">docker pull sameersbn/postgresql</div><div class="line">docker pull sameersbn/gitlab</div></pre></td></tr></table></figure>
<p>这里由于docker的官方镜像服务器在国外，所以访问速度比较慢。我们可以选择使用阿里云的镜像服务器进行加速。</p>
<p><a href="http://www.cnblogs.com/anliven/p/6218741.html" target="_blank" rel="external">http://www.cnblogs.com/anliven/p/6218741.html</a></p>
<h5 id="1-2-PostgreSQL介绍"><a href="#1-2-PostgreSQL介绍" class="headerlink" title="1.2 PostgreSQL介绍"></a>1.2 PostgreSQL介绍</h5><p>docker运行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">docker run --name postgresql -d \</div><div class="line">-e &apos;DB_NAME=gitlabhq_production&apos; \</div><div class="line">-e &apos;DB_USER=gitlab&apos; \</div><div class="line">-e &apos;DB_PASS=password&apos; \</div><div class="line">-e &apos;DB_EXTENSION=pg_trgm&apos; \</div><div class="line">-v /Users/alan/postgresql/data:/var/lib/postgresql \</div><div class="line">sameersbn/postgresql</div></pre></td></tr></table></figure>
<h5 id="1-3-Redis介绍"><a href="#1-3-Redis介绍" class="headerlink" title="1.3 Redis介绍"></a>1.3 Redis介绍</h5><p>docker运行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker run --name redis -d \</div><div class="line">-v /Users/alan/redis/data:/var/lib/redis \</div><div class="line">sameersbn/redis</div></pre></td></tr></table></figure>
<h5 id="1-4-搭建Gitlab"><a href="#1-4-搭建Gitlab" class="headerlink" title="1.4 搭建Gitlab"></a>1.4 搭建Gitlab</h5><p>当我们将PostgreSQL和redis跑起来之后，我们就可以进行gitlab的启动了。</p>
<p>docker运行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">docker run --name gitlab -d \</div><div class="line">--link postgresql:postgresql --link redis:redisio \</div><div class="line">-p 10022:22 -p 10080:80 \</div><div class="line">-e &apos;GITLAB_PORT=10080&apos; \</div><div class="line">-e &apos;GITLAB_SSH_PORT=10022&apos; \</div><div class="line">-e &apos;GITLAB_SECRETS_DB_KEY_BASE=long-and-random-alpha-numeric-string&apos; \</div><div class="line">-e &apos;GITLAB_SECRETS_SECRET_KEY_BASE=long-and-random-alpha-numeric-string&apos; \</div><div class="line">-e &apos;GITLAB_SECRETS_OTP_KEY_BASE=long-and-random-alpha-numeric-string&apos; \</div><div class="line">-e &apos;GITLAB_HOST=服务器地址&apos; \</div><div class="line">-e &apos;GITLAB_EMAIL=邮箱地址&apos; \</div><div class="line">-e &apos;SMTP_ENABLED=true&apos; \</div><div class="line">-e &apos;SMTP_DOMAIN=www.sina.com&apos; \</div><div class="line">-e &apos;SMTP_HOST=smtp.sina.com&apos; \</div><div class="line">-e &apos;SMTP_STARTTLS=false&apos;  \</div><div class="line">-e &apos;SMTP_USER=邮箱地址&apos; \</div><div class="line">-e &apos;SMTP_PASS=邮箱密码&apos; \</div><div class="line">-e &apos;SMTP_AUTHENTICATION=login&apos; \</div><div class="line">-e &apos;GITLAB_BACKUP_SCHEDULE=daily&apos; \</div><div class="line">-e &apos;GITLAB_BACKUP_TIME=10:30&apos; \</div><div class="line">-v /home/root/opt/gitlab/data:/home/git/data \</div><div class="line">sameersbn/gitlab</div></pre></td></tr></table></figure>
<h5 id="1-5gitlab配置"><a href="#1-5gitlab配置" class="headerlink" title="1.5gitlab配置"></a>1.5gitlab配置</h5><p>当我们把gitlab运行起来之后，就可以访问默认的10080端口访问gitlab了。</p>
<font color="red">注意到可能初次访问有时会出现502错误，多试几次即可</font>

<p>当初次进入gitlab的页面时，需要重置管理员密码，然后跳转到登录界面。</p>
<p>默认用户名是root，密码为刚刚设置的密码。</p>
<p>登录完成之后就可以进入gitlab页面，具体使用跟github网站类似。</p>
<p>首先需要将本机的公钥输入到设置当中进行身份验证。</p>
<p>右上角找到<strong>settings</strong></p>
<p><img src="http://ondsf10qe.bkt.clouddn.com/jenkins26.png" alt=""></p>
<p>左侧找到<strong>SSH Keys</strong></p>
<p><img src="http://ondsf10qe.bkt.clouddn.com/jenkins27.png" alt=""></p>
<p>将本机的公钥填入即可，生成公钥可参考<a href="http://blog.csdn.net/qaz13177_58_/article/details/27544177" target="_blank" rel="external">如何生成ssh公钥</a></p>
<p><img src="http://ondsf10qe.bkt.clouddn.com/jenkins28.png" alt=""></p>
<p>现在即可如github一般使用gitlab了，可参考我的<a href="http://pirrla.cn/2017/03/16/other/GitTutorial_ByLiaoxuefeng/" target="_blank" rel="external">GIT学习笔记</a>，除了有一点不同</p>
<p>在github时，我们对github的访问是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git@github.com:alanhuangym/learngit.git</div></pre></td></tr></table></figure>
<p>现在使用gitlab我们使用ssh（10022端口）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh://git@localhost:10022/root/test.git</div></pre></td></tr></table></figure>
<p>当然也可以使用http连接（10080端口）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:10080/root/test.git</div></pre></td></tr></table></figure>
<h3 id="2-搭建基于git的代码质量管理"><a href="#2-搭建基于git的代码质量管理" class="headerlink" title="2.搭建基于git的代码质量管理"></a>2.搭建基于git的代码质量管理</h3><p>对于git，我们主要使用的是git hook对git进行代码质量管理。</p>
<p>代码质量管理不仅仅是指希望对代码可以执行，没有语法错误，我们更希望能实现例如代码注释率、代码重复率等高级指标，从而提高代码仓库的代码质量的目的，避免低质量、错误的代码入库。</p>
<blockquote>
<p>Git 钩子是在 Git 仓库中特定事件发生时自动运行的脚本。它可以让你自定义 Git 内部的行为，在开发周期中的关键点触发自定义的行为。</p>
<p>Git 钩子最常见的使用场景包括推行提交规范，根据仓库状态改变项目环境，和接入持续集成工作流。但是，因为脚本可以完全定制，你可以用 Git 钩子来自动化或者优化你开发工作流中任意部分。</p>
</blockquote>
<p>我们知道，git有两个仓库，一个是本地仓库，一个是远程仓库。所以对git的代码质量管理也有两个层面，一个是本地层面的<strong>Client-Side Hooks</strong>，另一个则是服务器层面的<strong>Server-Side Hooks</strong>。</p>
<h5 id="2-1-本地仓库管理"><a href="#2-1-本地仓库管理" class="headerlink" title="2.1 本地仓库管理"></a>2.1 本地仓库管理</h5><p>不论使用的是gitlab或者github，都有本地仓库hook管理。</p>
<p>在每一个git的项目中，都有一个<code>.git</code>隐藏文件夹，进入到里面的<code>hook</code>文件夹就可以看到一些已经预设好的hook脚本。</p>
<p><img src="http://ondsf10qe.bkt.clouddn.com/jenkins29.png" alt=""></p>
<p>他们都带着<code>.sample</code>的后缀，证明他们是供我们参考的，拓展名防止它们默认被执行，如果希望执行这些hook，可以将<code>.sample</code>后缀去除。</p>
<p>这里钩子的脚本语言没有限制，一般的shell，ruby，python都可以。</p>
<p><strong>命名方式</strong>是决定他们在Git的哪一步被执行，所以命名方式需要注意，例如<code>pre-commit</code>钩子就是在用户进行commit操作的时候，在进行commit操作之前运行，详细的每个钩子的执行位置可以查看<a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" target="_blank" rel="external">官方文档</a>，这里介绍一些比较实用的。</p>
<ul>
<li><code>pre-commit</code>是我们希望实现的代码质量管理的一个好钩子，它在用户在进行<code>git commit -m &quot;注释&quot;</code>提交修改到本地仓库时执行，在提交操作之前执行脚本，如果脚本没有通过，则不会执行提交修改操作，返回错误。</li>
</ul>
<p>这样的话我们就可以通过<code>pre-commit</code>钩子实现代码质量管理了，在<code>pre-commit</code>中写入代码质量管理的脚本，当质量过关时，返回<code>0</code>，即脚本已通过，可以执行<code>commit</code>操作，当质量不过关时，返回<code>非0数值</code>，此时脚本未通过，<code>commit</code>操作未成功，即实现了阻止错误、低质量代码进入代码库的操作。</p>
<p><font color="red">但是</font>我们需要注意到，<code>.git</code>文件是不会提交到远程仓库的，所以<code>pre-commit</code>脚本是不能同步到所有的协作者<code>.git</code>文件夹中的。</p>
<p>即是<code>pre-commit</code>脚本的作用域只在本机，且不受服务器控制（可以被本机删除而不执行）。所以，如果希望通过<code>pre-commit</code>进行版本质量管理，只能将脚本放在<code>.git</code>文件夹外，提交到远程仓库，同时需要复制文件进每一个协作者的<code>.git/hook</code>文件夹中。这样是一种<strong>鼓励形式</strong>的代码质量管理，可行性不高。</p>
<h5 id="2-2-远程仓库管理（重点）"><a href="#2-2-远程仓库管理（重点）" class="headerlink" title="2.2 远程仓库管理（重点）"></a>2.2 远程仓库管理（重点）</h5><p>由于本地仓库的钩子不能实现我们希望的效果，所以我们选择在服务端进行钩子脚本构建。在服务器端构建钩子有以下好处：</p>
<ul>
<li>无法被本地修改，强制进行质量管理</li>
<li>可以统一在服务器进行对质量管理阈值的修改</li>
</ul>
<p>同时也有部分的缺点：</p>
<ul>
<li>没有一个通用的代码质量管理软件，只能对应每一个项目建立相对语言的代码质量管理</li>
</ul>
<h6 id="2-2-1-全局钩子"><a href="#2-2-1-全局钩子" class="headerlink" title="2.2.1 全局钩子"></a>2.2.1 全局钩子</h6><p>当使用docker构建gitlab时，远程仓库的脚本存在于docker容器内的<code>/home/git/gitlab-shell/hooks</code>路径当中。</p>
<p>进入docker容器内可以使用命令<code>docker exec -it 容器ID /bin/bash</code></p>
<p>这个路径下存放有三个钩子，分别是<code>pre-receive</code>，<code>post-receive</code>和<code>update</code>。</p>
<p>这三个是<font color="red">gitlab全局的钩子脚本</font>，就是这三个脚本对gitlab内的所有项目启用。他们三个的运行顺序如下</p>
<p><img src="http://ondsf10qe.bkt.clouddn.com/jenkins32.png" alt=""></p>
<p>他们各自代表的步骤是：</p>
<ul>
<li><p>pre-receive</p>
<p>在服务器收到用户推送的代码之前，进行操作</p>
</li>
</ul>
<ul>
<li><p>update</p>
<p>服务器已经收到代码之后，对分支进行更新的操作，如果有多个分支则会运行多次update，且update操作之间<font color="red">相互独立</font>，失败不影响其他</p>
</li>
</ul>
<ul>
<li><p>post-receive</p>
<p>在服务器已经更新完服务器端的代码之后的操作，一般是对客户返回信息</p>
</li>
</ul>
<p>所以如果我们需要对代码进行质量管理，应该选择的是<code>pre-receive</code>钩子。</p>
<h6 id="2-2-2-项目钩子"><a href="#2-2-2-项目钩子" class="headerlink" title="2.2.2 项目钩子"></a>2.2.2 项目钩子</h6><p>但是如果我们想用这三个全局钩子对所有的项目进行质量管理是不科学的，首先是因为没有一个通用的全代码质量管理工具，所以不能对全局使用同一个脚本，需要对不同的编程语言使用不同的脚本，其次，每一个项目可能会有特殊的需求，使用全局脚本不现实。所以我们需要找到每个脚本各自的<code>pre-receive</code>钩子。</p>
<p>每一个项目各自的钩子可以在路径<code>/home/git/data/repositories/用户名/项目名.git</code>或者<code>/home/git/repositories/&lt;group&gt;/&lt;project&gt;.git</code>路径中找到。</p>
<p>文件夹当中有一个<code>hooks</code>文件夹，<font color="red">但是</font>这个是一个超链接，跳转到的是全局钩子的地址<code>/home/git/gitlab-shell/hooks</code>。</p>
<p>我们就可以知道，项目是通过这个超链接去调用全局脚本的，所以如果我们希望项目能调用自己的脚本，那么我们可以创建一个同名的<code>hooks</code>文件夹替代，从而实现项目的个性化处理。</p>
<p><font color="red">不过需要注意的是</font>，当我们使用自定义的脚本的时候 ，如果将全局脚本当做模板进行改写的时候，全局脚本内有一些关联路径的语句，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">require_relative &apos;../lib/gitlab_custom_hook</div></pre></td></tr></table></figure>
<p>这里是定义了全局脚本的<font color="red">相对地址</font>，所以我们需要更改为<font color="red">绝对地址</font>，例如改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">require_relative &apos;/home/git/gitlab-shell/lib/gitlab_custom_hook</div></pre></td></tr></table></figure>
<p>为了实现我们的项目钩子的编写，查看<a href="https://docs.gitlab.com/ee/administration/custom_hooks.html" target="_blank" rel="external">官方文档</a>，我们了解到自定义钩子的写法是在<code>/home/git/repositories/&lt;group&gt;/&lt;project&gt;.git</code>文件夹内创建一个名为<code>custome_hooks</code>的文件夹，然后再文件夹内放置脚本，放置脚本的方法也有两种：</p>
<ul>
<li><p>直接创建同名的<font color="red">可执行</font>脚本</p>
<p>例如直接创建一个名为<code>pre-receive</code>的<font color="red">可执行</font>脚本</p>
</li>
</ul>
<ul>
<li><p>创建同名后缀为<code>.d</code>的文件夹，文件夹内放置脚本（命名随意）</p>
<p>例如创建一个<code>pre-receive.d</code>文件夹，在文件夹内放入一些<font color="red">可执行</font>脚本，则会按照命名顺序，顺序执行</p>
</li>
</ul>
<p><img src="http://ondsf10qe.bkt.clouddn.com/jenkins35.png" alt=""></p>
<p><font color="red">**</font>这里我们遇到的可执行脚本的问题，可以通过命令行解决，只需要一行命令<code>chmod +x 文件名</code>即可以将脚本变为可执行脚本</p>
<p><font color="red">需要注意的是</font>，如果没有将脚本变为可执行，那么脚本将不会在自定义钩子中生效。</p>
<p>我们的自定义钩子是在官方的脚本运行结束后运行的，但是因为自定义钩子的写法也有不同，所以运行自定义钩子的顺序也有所不同，通过实验（通过对所有脚本加上一个命令行输出查看），我们了解到顺序如下：</p>
<p><img src="http://ondsf10qe.bkt.clouddn.com/jenkins33.png" alt=""></p>
<p><img src="http://ondsf10qe.bkt.clouddn.com/jenkins34.png" alt=""></p>
<h3 id="3-钩子脚本编写"><a href="#3-钩子脚本编写" class="headerlink" title="3.钩子脚本编写"></a>3.钩子脚本编写</h3><p>当我们了解完全局钩子和自定义钩子的写法和执行顺序之后，我们就可以开始部署我们的代码质量检查钩子的编写了。由于没有一个统一的软件对全部代码进行统一的代码检测，所以我们将针对不同语言的项目进行不同的代码质量管理部署。</p>
<h5 id="3-1-Python"><a href="#3-1-Python" class="headerlink" title="3.1 Python"></a>3.1 Python</h5><p>References:</p>
<p>[1] <a href="http://blog.csdn.net/abcdocker/article/category/6638595" target="_blank" rel="external">持续集成 by www.abcdocker.com</a></p>
<p>[2] <a href="https://www.jianshu.com/p/060e7223e211?open_source=weibo_search" target="_blank" rel="external">使用docker搭建gitlab初体验+数据备份</a></p>
<p>[3] <a href="https://www.jianshu.com/p/5531a21afa68" target="_blank" rel="external">Gitlab 服务器端 custom hook 配置</a></p>
<p>[4] <a href="https://github.com/geeeeeeeeek/git-recipes/wiki/5.4-Git-%E9%92%A9%E5%AD%90%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%A0%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81" target="_blank" rel="external">Git 钩子</a></p>
<p>[5] <a href="https://docs.gitlab.com/ee/administration/custom_hooks.html" target="_blank" rel="external">Custom Git Hooks </a></p>
<p>[6] <a href="https://www.zhihu.com/question/65604891/answer/232935144" target="_blank" rel="external">https://www.zhihu.com/question/65604891/answer/232935144</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/jenkins/" rel="tag"># jenkins</a>
          
            <a href="/tags/git/" rel="tag"># git</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/22/jenkins/jenkins5/" rel="next" title="Jenkins学习笔记5-官方用法pipeline">
                <i class="fa fa-chevron-left"></i> Jenkins学习笔记5-官方用法pipeline
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/24/jenkins/jenkins7/" rel="prev" title="Jenkins学习笔记7-Docker WebGUI管理">
                Jenkins学习笔记7-Docker WebGUI管理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ondsf10qe.bkt.clouddn.com/avatar01.png"
               alt="Alan Wong" />
          <p class="site-author-name" itemprop="name">Alan Wong</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/alanhuangym" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-搭建gitlab仓库"><span class="nav-number">1.</span> <span class="nav-text">1. 搭建gitlab仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-安装前准备工作"><span class="nav-number">1.0.1.</span> <span class="nav-text">1.1 安装前准备工作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-PostgreSQL介绍"><span class="nav-number">1.0.2.</span> <span class="nav-text">1.2 PostgreSQL介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-Redis介绍"><span class="nav-number">1.0.3.</span> <span class="nav-text">1.3 Redis介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-搭建Gitlab"><span class="nav-number">1.0.4.</span> <span class="nav-text">1.4 搭建Gitlab</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-5gitlab配置"><span class="nav-number">1.0.5.</span> <span class="nav-text">1.5gitlab配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-搭建基于git的代码质量管理"><span class="nav-number">2.</span> <span class="nav-text">2.搭建基于git的代码质量管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-本地仓库管理"><span class="nav-number">2.0.1.</span> <span class="nav-text">2.1 本地仓库管理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-远程仓库管理（重点）"><span class="nav-number">2.0.2.</span> <span class="nav-text">2.2 远程仓库管理（重点）</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#2-2-1-全局钩子"><span class="nav-number">2.0.2.1.</span> <span class="nav-text">2.2.1 全局钩子</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-2-2-项目钩子"><span class="nav-number">2.0.2.2.</span> <span class="nav-text">2.2.2 项目钩子</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-钩子脚本编写"><span class="nav-number">3.</span> <span class="nav-text">3.钩子脚本编写</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-Python"><span class="nav-number">3.0.1.</span> <span class="nav-text">3.1 Python</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alan Wong</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
